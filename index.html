<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>20å²ç”Ÿæ—¥å¿«ä¹ï¼</title>
    <!-- ğŸ”¥ ç«™é…·å¿«ä¹ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* --- å…¨å±€æ ·å¼ --- */
        :root {
            --bg-color: #fffafc;
            --primary-color: #ff8eab;
            --text-color: #5d4037;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'ZCOOL KuaiLe', "Mady", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: relative;
        }

        /* --- é¡µé¢åŸºç¡€ --- */
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.6s ease;
            opacity: 0;
            pointer-events: none;
            transform: translateY(100%) scale(0.9);
            background-image: radial-gradient(#ffeef2 20%, transparent 20%);
            background-size: 20px 20px;
            z-index: 10;
        }

        .page.active {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0) scale(1);
        }

        .page.prev {
            transform: translateY(-100%) scale(0.9);
            opacity: 0;
        }

        /* --- ç»„ä»¶æ ·å¼ --- */
        h1 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: var(--primary-color);
            text-shadow: 2px 2px 0px #fff;
            z-index: 20;
        }

        p {
            font-size: 1rem;
            line-height: 1.6;
            margin: 5px 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 15px;
            border-radius: 10px;
            z-index: 20;
            position: relative;
        }

        .gif-box {
            width: 180px;
            height: 180px;
            margin: 10px auto;
            border-radius: 50%;
            border: 4px solid #fff;
            box-shadow: 0 8px 15px rgba(255, 142, 171, 0.3);
            overflow: hidden;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 20;
        }

        .gif-box img {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
        }

        .deco-img {
            position: absolute;
            width: 60px;
            opacity: 0.9;
            z-index: 5;
            animation: floatDeco 3s ease-in-out infinite;
        }

        @keyframes floatDeco {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        /* --- ğŸï¸ ç…§ç‰‡å¢™å®¹å™¨ --- */
        .film-container {
            width: 100%;
            height: 350px;
            /* ç»™è¶³å¤Ÿç©ºé—´åšå¿ƒå½¢ */
            margin: 20px 0;
            position: relative;
            /* ä¸ºç»å¯¹å®šä½åšå‡†å¤‡ */
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 20;
            /* overflow: hidden;  å»æ‰hiddenä»¥ä¾¿å¿ƒå½¢å±•ç¤º */
        }

        .film-track {
            display: flex;
            gap: 15px;
            width: max-content;
            transition: opacity 0.5s;
        }

        .film-item {
            width: 100px;
            height: 125px;
            /* ç¨å¾®è°ƒå°ä¸€ç‚¹é€‚é…å¿ƒå½¢ */
            background: #fff;
            padding: 4px 4px 20px 4px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: rotate(var(--rot));
            flex-shrink: 0;
            border-radius: 4px;
            transition: all 1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            /* å¹³æ»‘è¿‡æ¸¡ */
            cursor: pointer;
            position: relative;
            /* é»˜è®¤ç›¸å¯¹å®šä½ */
        }

        /* å½“å½¢æˆå¿ƒå½¢æ—¶ï¼Œåº”ç”¨ç»å¯¹å®šä½ */
        .film-item.heart-mode {
            position: absolute;
            top: 50%;
            left: 50%;
            /* åˆå§‹ä¸­å¿ƒç‚¹ */
            margin-top: -62px;
            margin-left: -50px;
            /* å±…ä¸­ä¿®æ­£ */
            box-shadow: 0 0 15px rgba(255, 142, 171, 0.6);
            z-index: 100;
        }

        .film-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 2px;
        }

        @keyframes scrollLeft {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-50%);
            }
        }

        @keyframes scrollRight {
            0% {
                transform: translateX(-50%);
            }

            100% {
                transform: translateX(0);
            }
        }

        /* --- ğŸ” å›¾ç‰‡æŸ¥çœ‹å™¨ (Lightbox) --- */
        .lightbox-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
            backdrop-filter: blur(5px);
        }

        .lightbox-overlay.open {
            display: flex;
            opacity: 1;
        }

        .lightbox-content {
            width: 80%;
            max-height: 60%;
            border: 6px solid #fff;
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(255, 142, 171, 0.5);
            transform: scale(0.8);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 2005;
            object-fit: contain;
            position: relative;
        }

        .lightbox-overlay.open .lightbox-content {
            transform: scale(1);
        }

        /* ğŸ”¥ æ–°ç‰ˆï¼šæ‰‹å†™æ‚¬æµ®æ–‡å­—æ ·å¼ */
        .floating-text-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .handwritten-msg {
            position: absolute;
            color: #fff;
            font-size: 1.4rem;
            opacity: 0;
            white-space: nowrap;
            text-shadow: 2px 2px 4px rgba(255, 142, 171, 0.8);
            font-weight: bold;
            animation: appearFloat 3s ease-out forwards infinite alternate;
        }

        @keyframes appearFloat {
            0% {
                opacity: 0;
                transform: scale(0.8) translateY(10px) rotate(var(--r));
            }

            20% {
                opacity: 1;
                transform: scale(1.1) translateY(0) rotate(var(--r));
            }

            100% {
                opacity: 1;
                transform: scale(1) translateY(-10px) rotate(var(--r));
            }
        }

        /* --- äº¤äº’ç»„ä»¶ --- */
        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(255, 142, 171, 0.4);
            animation: bounce 2s infinite;
            margin-top: 10px;
            z-index: 30;
            transition: transform 0.3s;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .next-arrow {
            position: absolute;
            bottom: 25px;
            width: 30px;
            height: 30px;
            border-bottom: 4px solid var(--primary-color);
            border-right: 4px solid var(--primary-color);
            transform: rotate(45deg);
            animation: flash 1.5s infinite;
            cursor: pointer;
            z-index: 30;
        }

        .music-control {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 35px;
            height: 35px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--primary-color);
            cursor: pointer;
        }

        .music-control.playing {
            animation: spin 4s linear infinite;
        }

        /* --- å¼¹çª—ç»„ä»¶ --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .modal-overlay.open {
            display: flex;
            opacity: 1;
        }

        .modal-box {
            width: 80%;
            max-width: 320px;
            background: #fff;
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            border: 4px solid var(--primary-color);
            box-shadow: 0 10px 25px rgba(255, 142, 171, 0.5);
            transform: scale(0.7);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-overlay.open .modal-box {
            transform: scale(1);
        }

        @keyframes bounce {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        @keyframes flash {
            0% {
                opacity: 0;
                transform: rotate(45deg) translate(-5px, -5px);
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0;
                transform: rotate(45deg) translate(5px, 5px);
            }
        }

        @keyframes spin {
            100% {
                transform: rotate(360deg);
            }
        }

        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
    </style>
</head>

<body>

    <div class="music-control" id="bgmBtn">ğŸµ</div>
    <audio id="bgm" src="./mp3/bgm.mp3" loop></audio>
    <audio id="voice" src="./mp3/birthday_voice.mp3"></audio>
    <canvas id="canvas-container"></canvas>

    <!-- ================= é¡µé¢ 1: å°é¢ ================= -->
    <section class="page active" id="page1">
        <img src="./img/pd-image1.png" class="deco-img" style="top: 10%; left: 10%;">
        <img src="./img/pd-image2.png" class="deco-img" style="bottom: 15%; right: 10%;">
        <div class="gif-box"><img src="./gif/gif1.gif"></div>
        <h1>âœ¨ ç”Ÿæ—¥å¿«ä¹ âœ¨</h1>
        <p>To: äº²çˆ±çš„å°æ˜</p>
                <p style="font-size: 0.9rem; margin-top: 10px;">
            ä½ å·²ç»æ¥åˆ°è¿™ä¸ªåœ°çƒ<br>
            ç¬¬ <span class="stats-num" id="daysCount">7305</span> å¤©<br>
            ç¬¬ <span class="stats-num" id="hoursCount">175320</span> å°æ—¶<br>
            è¿™æ˜¯ä¸“å±äºä½ çš„é­”æ³•æ—¶åˆ»<br>å‡†å¤‡å¥½äº†å—ï¼Ÿ
        </p>
        <button class="btn" onclick="startJourney()">ğŸ å¼€å¯æƒŠå–œ</button>
    </section>

    <!-- ================= é¡µé¢ 2: å½•éŸ³ ================= -->
    <section class="page" id="page2">
        <div class="gif-box"><img src="./gif/gif2.gif"></div>
        <h1>å¬æˆ‘è¯´...</h1>
        <p>æœ‰äº›è¯èº²åœ¨ç©å¶é‡Œæ‚„æ‚„å‘Šè¯‰ä½ </p>
        <div style="background:#fff; padding:15px; border-radius:20px; border:2px dashed var(--primary-color); cursor:pointer;"
            onclick="playVoice()">
            <span class="voice-icon">â–¶ï¸ ç‚¹æˆ‘æ’­æ”¾</span>
        </div>
        <div class="next-arrow" onclick="nextPage(2)"></div>
    </section>

    <!-- ================= é¡µé¢ 3: ç¥ç¦ ================= -->
    <section class="page" id="page3">
        <div class="gif-box"><img src="./gif/gif3.gif"></div>
        <h1>æ„¿æœ›éƒ½å®ç°</h1>
        <p>ç¥ä½ åœ¨20å²çš„äººç”Ÿæ—·é‡é‡Œ<br>æ°¸è¿œåƒChiikawaä¸€æ ·æ— å¿§æ— è™‘</p>
        <div class="next-arrow" onclick="nextPage(3)"></div>
    </section>

    <!-- ================= é¡µé¢ 4: ç…§ç‰‡å¢™ (å‡†å¤‡å˜èº«çˆ±å¿ƒ) ================= -->
    <section class="page" id="page4">
        <img src="./gif/gif4.gif" style="width: 80px; margin-bottom: -10px;">
        <h1 id="photoTitle">æˆ‘ä»¬çš„ç‚¹æ»´</h1>

        <div class="film-container" id="photoWall">
            <div class="film-track" id="track1" style="animation: scrollLeft 20s linear infinite;">
                <!-- ç…§ç‰‡ ID ç”¨äºå®šä½ -->
                <div class="film-item" style="--rot:-2deg"><img src="./img/we1.jpg" onclick="openPhoto(this.src)"></div>
                <div class="film-item" style="--rot:1deg"><img src="./img/we2.jpg" onclick="openPhoto(this.src)"></div>
                <div class="film-item" style="--rot:-1deg"><img src="./img/we3.jpg" onclick="openPhoto(this.src)"></div>
                <div class="film-item" style="--rot:3deg"><img src="./img/we4.jpg" onclick="openPhoto(this.src)"></div>
                <div class="film-item" style="--rot:-2deg"><img src="./img/we5.jpg" onclick="openPhoto(this.src)"></div>
                <div class="film-item" style="--rot:2deg"><img src="./img/we6.jpg" onclick="openPhoto(this.src)"></div>
                <div class="film-item" style="--rot:1deg"><img src="./img/we7.jpg" onclick="openPhoto(this.src)"></div>
                <div class="film-item" style="--rot:-1deg"><img src="./img/we8.jpg" onclick="openPhoto(this.src)"></div>
            </div>
            <div class="film-track" id="track2" style="animation: scrollRight 25s linear infinite;">
                <div class="film-item" style="--rot:2deg"><img src="./img/we9.jpg" onclick="openPhoto(this.src)"></div>
                <div class="film-item" style="--rot:-1deg"><img src="./img/we10.jpg" onclick="openPhoto(this.src)">
                </div>
                <div class="film-item" style="--rot:3deg"><img src="./img/we11.jpg" onclick="openPhoto(this.src)"></div>
                <div class="film-item" style="--rot:-2deg"><img src="./img/we12.jpg" onclick="openPhoto(this.src)">
                </div>
                <div class="film-item" style="--rot:1deg"><img src="./img/we1.jpg" onclick="openPhoto(this.src)"></div>
                <div class="film-item" style="--rot:-3deg"><img src="./img/we2.jpg" onclick="openPhoto(this.src)"></div>
                <div class="film-item" style="--rot:2deg"><img src="./img/we3.jpg" onclick="openPhoto(this.src)"></div>
                <div class="film-item" style="--rot:-1deg"><img src="./img/we4.jpg" onclick="openPhoto(this.src)"></div>
            </div>
        </div>

        <button class="btn" id="heartBtn" onclick="formHeartShape()">ğŸ‚ çˆ±ä½ å“Ÿ</button>
    </section>

    <!-- ================= ğŸ” å›¾ç‰‡æŸ¥çœ‹å™¨ (æ‰‹å†™æ‚¬æµ®ç‰ˆ) ================= -->
    <div class="lightbox-overlay" id="imgLightbox" onclick="closePhoto()">
        <!-- æ‚¬æµ®æ–‡å­—å®¹å™¨ -->
        <div class="floating-text-container" id="floatTextContainer"></div>

        <!-- ä¸­é—´å›¾ç‰‡ -->
        <img id="lightboxImg" class="lightbox-content" src="">

        <div style="position:absolute; bottom:30px; color:#fff; opacity:0.6; font-size:0.9rem;">
            ç‚¹å‡»ä»»æ„å¤„å…³é—­
        </div>
    </div>

    <!-- ================= å¼¹çª—ç»„ä»¶ ================= -->
    <div class="modal-overlay" id="loveModal">
        <div class="modal-box">
            <h2>ğŸ‰ ç”Ÿæ—¥å¿«ä¹ï¼</h2>
            <div style="margin:20px 0; line-height:1.6;">
                æ­å–œå°æ˜åˆé•¿å¤§ä¸€å²å•¦ï¼<br>
                æœªæ¥çš„æ—¥å­é‡Œ<br>
                æˆ‘ä¹Ÿæƒ³ä¸€ç›´é™ªåœ¨ä½ èº«è¾¹<br>
                å¸Œæœ›ä½ å°‘ä¸€ç‚¹ç„¦è™‘<br>
                å¤šä¸€ç‚¹å¼€å¿ƒï¼<br>
                â¤ï¸
            </div>
            <button class="btn" onclick="closeModal()">æ”¶åˆ°å•¦</button>
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒé…ç½® ---
        const loveMessages = [
            "å°æ˜ç”Ÿæ—¥å¿«ä¹ï¼ğŸ‚", "æœ€çˆ±å°æ˜äº† â¤ï¸", "è¶…çº§æ— æ•Œå¯çˆ±",
            "è¦åšå¿«ä¹çš„å°æ˜", "æƒ³ä¸€ç›´æŠ±ç€ä½ ", "ä½ æ˜¯æˆ‘çš„å°å¤ªé˜³ â˜€ï¸",
            "å¾€åä½™ç”Ÿè¯·å¤šæŒ‡æ•™", "é—ªé—ªå‘å…‰ âœ¨", "æ¯å¤©éƒ½æƒ³ä½ ",
            "ä»Šå¤©çš„é£å¾ˆç”œ", "é™ªä½ å¥‡å¥‡æ€ªæ€ª", "é™ªä½ å¯å¯çˆ±çˆ±",
            "Love You Forever", "(ã¥ï½¡â—•â€¿â€¿â—•ï½¡)ã¥"
        ];

        function startJourney() {
            const bgm = document.getElementById('bgm');
            bgm.volume = 0.5;
            bgm.play().catch(() => { }); // å¤„ç†è‡ªåŠ¨æ’­æ”¾é™åˆ¶
            document.getElementById('bgmBtn').classList.add('playing');
            if(navigator.vibrate) navigator.vibrate(50);
            nextPage(1);
        }

        // BGM æŒ‰é’®æ§åˆ¶
        document.getElementById('bgmBtn').addEventListener('click', function () {
            const bgm = document.getElementById('bgm');
            if (bgm.paused) { bgm.play(); this.classList.add('playing'); }
            else { bgm.pause(); this.classList.remove('playing'); }
        });

        function nextPage(c) {
            document.getElementById(`page${c}`).classList.replace('active', 'prev');
            document.getElementById(`page${c + 1}`).classList.add('active');
        }

        function playVoice() {
            const v = document.getElementById('voice');
            const b = document.getElementById('bgm');
            const oldVol = b.volume;
            b.volume = 0.1;
            v.play();
            v.onended = () => { b.volume = oldVol; };
        }

        // --- ğŸ” å‡çº§ç‰ˆï¼šæ‰‹å†™æ‚¬æµ®æŸ¥çœ‹å™¨ ---
        function openPhoto(src) {
            const lb = document.getElementById('imgLightbox');
            const container = document.getElementById('floatTextContainer');

            document.getElementById('lightboxImg').src = src;
            container.innerHTML = ''; // æ¸…ç©ºæ—§æ–‡å­—

            // éšæœºç”Ÿæˆ 6-8 ä¸ªæ‚¬æµ®æ–‡å­—
            const count = 6 + Math.floor(Math.random() * 3);
            for (let i = 0; i < count; i++) {
                const span = document.createElement('span');
                span.className = 'handwritten-msg';
                span.innerText = loveMessages[Math.floor(Math.random() * loveMessages.length)];

                // éšæœºä½ç½® (é¿å¼€ä¸­å¿ƒåŒºåŸŸå¤§è‡´èŒƒå›´)
                let top, left;
                if (Math.random() > 0.5) {
                    top = Math.random() * 30 + '%'; // ä¸Šæ–¹åŒºåŸŸ
                } else {
                    top = (70 + Math.random() * 20) + '%'; // ä¸‹æ–¹åŒºåŸŸ
                }
                left = Math.random() * 80 + 10 + '%';

                // éšæœºå€¾æ–œè§’åº¦
                const rot = (Math.random() * 30 - 15) + 'deg';
                // éšæœºåŠ¨ç”»å»¶è¿Ÿ
                const delay = Math.random() * 2 + 's';
                // éšæœºå­—ä½“å¤§å°å·®å¼‚
                const sizeScale = 0.8 + Math.random() * 0.5;

                span.style.top = top;
                span.style.left = left;
                span.style.setProperty('--r', rot);
                span.style.animationDelay = delay;
                span.style.fontSize = (1.4 * sizeScale) + 'rem';

                container.appendChild(span);
            }

            lb.style.display = 'flex';
            setTimeout(() => lb.classList.add('open'), 10);
        }

        function closePhoto() {
            const lb = document.getElementById('imgLightbox');
            lb.classList.remove('open');
            setTimeout(() => lb.style.display = 'none', 300);
        }

        // --- â¤ï¸ æ ¸å¿ƒé€»è¾‘ï¼šç…§ç‰‡èšåˆæˆçˆ±å¿ƒ ---
        function formHeartShape() {
            const wall = document.getElementById('photoWall');
            const btn = document.getElementById('heartBtn');
            const tracks = document.querySelectorAll('.film-track');

            // 1. åœæ­¢æ»šåŠ¨åŠ¨ç”»ï¼Œå‡†å¤‡ç§»åŠ¨ DOM
            tracks.forEach(t => t.style.animationPlayState = 'paused');
            btn.style.display = 'none'; // éšè—æŒ‰é’®
            document.getElementById('photoTitle').innerText = "â¤ï¸ æ°¸è¿œçˆ±ä½  â¤ï¸";

            // 2. æ”¶é›†æ‰€æœ‰å›¾ç‰‡å…ƒç´ 
            const items = document.querySelectorAll('.film-item');
            const total = items.length;

            // 3. å°†å›¾ç‰‡ä» track ä¸­å–å‡ºï¼Œç›´æ¥æ”¾å…¥ wall å®¹å™¨ï¼Œä»¥ä¾¿ç»Ÿä¸€ç»å¯¹å®šä½
            // æ³¨æ„ï¼šè¿™ä¼šæ‰“ä¹± DOM ç»“æ„ï¼Œä½†ä¸ºäº†åŠ¨ç”»æ•ˆæœæ˜¯å¿…é¡»çš„
            const frag = document.createDocumentFragment();
            items.forEach(item => {
                // å…‹éš†èŠ‚ç‚¹æˆ–ç›´æ¥ç§»åŠ¨ (è¿™é‡Œç›´æ¥ç§»åŠ¨)
                // å…ˆè®¡ç®—å½“å‰ç›¸å¯¹äºè§†å£çš„ä½ç½®ï¼Œä¿æŒè§†è§‰è¿è´¯æ€§(å¯é€‰ï¼Œè¿™é‡Œç›´æ¥é£èšæ›´éœ‡æ’¼)
                item.classList.add('heart-mode');
                frag.appendChild(item);
            });

            // æ¸…ç©º trackï¼Œåªç•™ item
            wall.innerHTML = '';
            wall.appendChild(frag);

            // 4. è®¡ç®—çˆ±å¿ƒåæ ‡å…¬å¼
            // x = 16sin^3(t)
            // y = 13cos(t) - 5cos(2t) - 2cos(3t) - cos(4t)
            const scale = 7; // ç¼©æ”¾ç³»æ•°

            setTimeout(() => {
                items.forEach((item, index) => {
                    // t ä» 0 åˆ° 2PI
                    const t = (index / total) * Math.PI * 2;
                    const x = 16 * Math.pow(Math.sin(t), 3);
                    const y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));

                    // åº”ç”¨åæ ‡ (åç§»ä¸­å¿ƒ)
                    // x * scale px, y * scale px
                    item.style.transform = `translate(${x * scale}px, ${y * scale}px) rotate(${Math.random() * 20 - 10}deg)`;
                    item.style.zIndex = index + 10;
                });
            }, 50);
            
            if(navigator.vibrate) navigator.vibrate([100, 50, 100]);
            
            // 5. å»¶è¿Ÿå¼¹å‡ºç¥ç¦è¯­
            setTimeout(() => {
                showModal();
            }, 1800);
        }

        function showModal() {
            const m = document.getElementById('loveModal');
            m.style.display = 'flex';
            setTimeout(() => m.classList.add('open'), 10);

            // æ–°å¢ï¼šå½©å¸¦ç‰¹æ•ˆ
            var duration = 3000;
            var end = Date.now() + duration;
            (function frame() {
                confetti({
                    particleCount: 5,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: ['#ff8eab', '#ffffff', '#ffd700'] // é…åˆä½ çš„ä¸»é¢˜è‰²
                });
                confetti({
                    particleCount: 5,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: ['#ff8eab', '#ffffff', '#ffd700']
                });
                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());
        }

        function closeModal() {
            const m = document.getElementById('loveModal');
            m.classList.remove('open');
            setTimeout(() => m.style.display = 'none', 300);
        }

        // --- é£˜è½ç‰¹æ•ˆ ---
        const canvas = document.getElementById('canvas-container');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        const particles = [];
        class P {
            constructor() { this.r(); }
            r() {
                this.x = Math.random() * canvas.width; this.y = -20;
                this.s = Math.random() * 20 + 10; this.v = Math.random() * 2 + 1;
                this.t = ['âœ¨', 'â¤ï¸', 'â­', 'ğŸµ'][Math.floor(Math.random() * 4)];
            }
            u() { this.y += this.v; if (this.y > canvas.height) this.r(); }
            d() { ctx.font = this.s + 'px Arial'; ctx.fillText(this.t, this.x, this.y); }
        }
        for (let i = 0; i < 30; i++) particles.push(new P());
        function anim() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'rgba(255,142,171,0.5)';
            particles.forEach(p => { p.u(); p.d(); });
            requestAnimationFrame(anim);
        }
        anim();
    </script>
</body>

</html>